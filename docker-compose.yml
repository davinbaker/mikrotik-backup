services:
  mikrotik-backup:
    build: .
    container_name: mikrotik-backup
    restart: unless-stopped

    environment:
      MIKROTIK_HOST: "${MIKROTIK_HOST}"
      MIKROTIK_USER: "${MIKROTIK_USER}"
      MIKROTIK_PORT: "${MIKROTIK_PORT}"
      SSH_KEY_PATH: "${SSH_KEY_PATH}"
      RCLONE_REMOTE: "${RCLONE_REMOTE}"
      RCLONE_PATH: "${RCLONE_PATH}"
      RETAIN_DAYS: "${RETAIN_DAYS}"
      CRON_SCHEDULE: "${CRON_SCHEDULE}"
      TZ: "${TZ}"

    volumes:
      # rclone config with OneDrive token
      - /opt/mikrotik-backup/config/rclone.conf:/config/rclone.conf:ro
      # SSH private key for MikroTik
      - /opt/mikrotik-backup/secrets/mikrotik_id_rsa:/secrets/mikrotik_id_rsa:ro

    # Optional: resource limits
    deploy:
      resources:
        limits:
          memory: 128m
